{
  "version": 3,
  "sources": ["../bundle-05BlMp/strip-cf-connecting-ip-header.js", "../../../node_modules/nanoid/url-alphabet/index.js", "../../../node_modules/nanoid/index.browser.js", "../../../src/room-do.ts", "../../../src/worker.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-05BlMp/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-05BlMp/middleware-loader.entry.ts"],
  "sourceRoot": "/mnt/c/Code/sprintstorypoint/worker/.wrangler/tmp/dev-0w2dVj",
  "sourcesContent": ["function stripCfConnectingIPHeader(input, init) {\n\tconst request = new Request(input, init);\n\trequest.headers.delete(\"CF-Connecting-IP\");\n\treturn request;\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\treturn Reflect.apply(target, thisArg, [\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\n\t\t]);\n\t},\n});\n", "export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n", "/* @ts-self-types=\"./index.d.ts\" */\nimport { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << Math.log2(alphabet.length - 1)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step | 0\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length >= size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size | 0, random)\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array((size |= 0)))\n  while (size--) {\n    id += scopedUrlAlphabet[bytes[size] & 63]\n  }\n  return id\n}\n", "export type DeckType = \"fibonacci\" | \"tshirt\" | \"custom\";\r\n\r\ntype Story = {\r\n  id: string;\r\n  title: string;\r\n  notes?: string;\r\n};\r\n\r\ntype ChatMessage = {\r\n  id: string;\r\n  clientId: string;\r\n  name: string;\r\n  text: string;\r\n  timestamp: number;\r\n};\r\n\r\ntype RoomState = {\r\n  roomId: string;\r\n  createdAt: number;\r\n  expiresAt: number;\r\n\r\n  deck: { type: DeckType; custom?: string[] };\r\n  funMode: boolean;\r\n\r\n  stories: Story[];\r\n  currentStoryId: string | null;\r\n\r\n  phase: \"voting\" | \"revealed\" | \"locked\";\r\n  // votesByStory[storyId][clientId] = value\r\n  votesByStory: Record<string, Record<string, string>>;\r\n  lockedByStory: Record<string, string>;\r\n\r\n  participants: Record<string, { name: string; avatar: string; joinedAt: number }>;\r\n\r\n  // Chat messages (keep last 50)\r\n  chatMessages: ChatMessage[];\r\n};\r\n\r\ntype ClientMsg =\r\n  | { type: \"join\"; name?: string }\r\n  | { type: \"setName\"; name: string }\r\n  | { type: \"setAvatar\"; avatar: string }\r\n  | { type: \"setDeck\"; deck: { type: DeckType; custom?: string[] } }\r\n  | { type: \"toggleFun\"; funMode: boolean }\r\n  | { type: \"addStory\"; title: string; notes?: string }\r\n  | { type: \"editStory\"; storyId: string; title: string }\r\n  | { type: \"updateNotes\"; storyId: string; notes: string }\r\n  | { type: \"deleteStory\"; storyId: string }\r\n  | { type: \"setCurrentStory\"; storyId: string }\r\n  | { type: \"vote\"; storyId: string; value: string }\r\n  | { type: \"reveal\"; roomSecret?: string }\r\n  | { type: \"lock\"; storyId: string; value: string; roomSecret?: string }\r\n  | { type: \"next\"; roomSecret?: string }\r\n  | { type: \"clearVotes\"; storyId: string; roomSecret?: string }\r\n  | { type: \"chat\"; text: string }\r\n  | { type: \"finish\"; roomSecret?: string };\r\n\r\ntype ServerMsg =\r\n  | { type: \"hello\"; clientId: string }\r\n  | { type: \"state\"; state: RoomState; derived: DerivedState }\r\n  | { type: \"error\"; message: string }\r\n  | { type: \"chat\"; message: ChatMessage }\r\n  | { type: \"finished\"; reason: string };\r\n\r\ntype DerivedState = {\r\n  currentStory?: Story | null;\r\n  stats?: { min?: number; max?: number; median?: number; spread?: number } | null;\r\n  waitingFor: number;\r\n};\r\n\r\n// ============ Configuration Constants ============\r\nconst MAX_MSG_BYTES = 4096;        // Max WebSocket message size\r\nconst MAX_PARTICIPANTS = 25;       // Max participants per room (demo limit)\r\nconst MAX_STORIES = 50;            // Max stories per room\r\nconst MAX_CHAT_MESSAGES = 50;      // Max chat messages to retain\r\nconst MAX_STORY_TITLE_LEN = 120;   // Max story title length\r\nconst MAX_STORY_NOTES_LEN = 1000;  // Max story notes length\r\nconst MAX_CHAT_MSG_LEN = 500;      // Max chat message length\r\nconst MAX_NAME_LEN = 24;           // Max participant name length\r\nconst MAX_VOTE_LEN = 12;           // Max vote value length\r\nconst MAX_CUSTOM_DECK_SIZE = 20;   // Max custom deck values\r\nconst TTL_MS = 24 * 60 * 60 * 1000; // 24 hours room TTL\r\n\r\n// Rate limiting: messages per client per minute\r\nconst RATE_LIMIT_WINDOW_MS = 60000; // 1 minute\r\nconst RATE_LIMIT_MAX_MSGS = 60;     // Max 60 messages per minute per client\r\n\r\n// 100+ fun emoji avatars for participants\r\nconst AVATARS = [\r\n  // Animals\r\n  \"\uD83E\uDD8A\", \"\uD83D\uDC3C\", \"\uD83E\uDD81\", \"\uD83D\uDC2F\", \"\uD83D\uDC3B\", \"\uD83D\uDC28\", \"\uD83D\uDC38\", \"\uD83D\uDC35\", \"\uD83E\uDD84\", \"\uD83D\uDC32\",\r\n  \"\uD83E\uDD8B\", \"\uD83D\uDC1D\", \"\uD83E\uDD85\", \"\uD83E\uDD89\", \"\uD83D\uDC27\", \"\uD83D\uDC26\", \"\uD83E\uDD86\", \"\uD83E\uDDA2\", \"\uD83E\uDDA9\", \"\uD83D\uDC22\",\r\n  \"\uD83D\uDC19\", \"\uD83E\uDD91\", \"\uD83E\uDD90\", \"\uD83E\uDD80\", \"\uD83D\uDC21\", \"\uD83D\uDC2C\", \"\uD83D\uDC33\", \"\uD83E\uDD88\", \"\uD83D\uDC0A\", \"\uD83E\uDD8E\",\r\n  \"\uD83D\uDC0D\", \"\uD83E\uDD95\", \"\uD83E\uDD96\", \"\uD83D\uDC18\", \"\uD83E\uDD8F\", \"\uD83E\uDD9B\", \"\uD83D\uDC2A\", \"\uD83E\uDD92\", \"\uD83E\uDD98\", \"\uD83E\uDDAC\",\r\n  \"\uD83D\uDC03\", \"\uD83D\uDC02\", \"\uD83D\uDC04\", \"\uD83D\uDC0E\", \"\uD83E\uDD8C\", \"\uD83D\uDC11\", \"\uD83D\uDC10\", \"\uD83E\uDD99\", \"\uD83D\uDC16\", \"\uD83D\uDC17\",\r\n  // Fantasy & Fun\r\n  \"\uD83E\uDD16\", \"\uD83D\uDC7E\", \"\uD83D\uDC7D\", \"\uD83D\uDC7B\", \"\uD83D\uDC80\", \"\uD83C\uDF83\", \"\uD83E\uDDB8\", \"\uD83E\uDDB9\", \"\uD83E\uDDD9\", \"\uD83E\uDDDA\",\r\n  \"\uD83E\uDDDB\", \"\uD83E\uDDDC\", \"\uD83E\uDDDD\", \"\uD83E\uDDDE\", \"\uD83E\uDDDF\", \"\uD83E\uDD77\", \"\uD83E\uDDB4\", \"\uD83C\uDF1F\", \"\u2B50\", \"\uD83C\uDF19\",\r\n  \"\u2600\uFE0F\", \"\uD83C\uDF08\", \"\u26A1\", \"\uD83D\uDD25\", \"\uD83D\uDCA7\", \"\u2744\uFE0F\", \"\uD83C\uDF0A\", \"\uD83C\uDF38\", \"\uD83C\uDF3A\", \"\uD83C\uDF3B\",\r\n  // Objects & Symbols\r\n  \"\uD83C\uDFAF\", \"\uD83C\uDFA8\", \"\uD83C\uDFAD\", \"\uD83C\uDFAA\", \"\uD83C\uDFA2\", \"\uD83D\uDE80\", \"\uD83D\uDEF8\", \"\uD83C\uDFAE\", \"\uD83C\uDFB2\", \"\uD83C\uDFB3\",\r\n  \"\uD83C\uDFC6\", \"\uD83E\uDD47\", \"\uD83C\uDF96\uFE0F\", \"\uD83C\uDFC5\", \"\u26BD\", \"\uD83C\uDFC0\", \"\uD83C\uDFC8\", \"\u26BE\", \"\uD83C\uDFBE\", \"\uD83C\uDFD0\",\r\n  \"\uD83C\uDFB1\", \"\uD83C\uDFD3\", \"\uD83C\uDFF8\", \"\uD83E\uDD4A\", \"\uD83C\uDFBF\", \"\uD83D\uDEF9\", \"\uD83D\uDEFC\", \"\uD83C\uDFB8\", \"\uD83C\uDFBA\", \"\uD83C\uDFB7\",\r\n  \"\uD83E\uDD41\", \"\uD83C\uDFB9\", \"\uD83C\uDFBB\", \"\uD83E\uDE97\", \"\uD83C\uDFA4\", \"\uD83C\uDFA7\", \"\uD83D\uDCFB\", \"\uD83D\uDCFA\", \"\uD83D\uDC8E\", \"\uD83D\uDCB0\"\r\n];\r\n\r\nfunction getRandomAvatar(usedAvatars: string[]): string {\r\n  const available = AVATARS.filter(a => !usedAvatars.includes(a));\r\n  if (available.length === 0) {\r\n    // Fallback: use a numbered avatar if all are taken\r\n    return `\uD83D\uDC64${usedAvatars.length + 1}`;\r\n  }\r\n  return available[Math.floor(Math.random() * available.length)];\r\n}\r\n\r\nfunction now() {\r\n  return Date.now();\r\n}\r\n\r\nfunction safeJsonParse<T>(text: string): T | null {\r\n  try { return JSON.parse(text) as T; } catch { return null; }\r\n}\r\n\r\nfunction median(nums: number[]) {\r\n  const a = [...nums].sort((x, y) => x - y);\r\n  const mid = Math.floor(a.length / 2);\r\n  return a.length % 2 ? a[mid] : (a[mid - 1] + a[mid]) / 2;\r\n}\r\n\r\nfunction toNumberMaybe(v: string): number | null {\r\n  // allow \"0\", \"0.5\", \"1\", etc. ignore tshirt\r\n  const n = Number(v);\r\n  return Number.isFinite(n) ? n : null;\r\n}\r\n\r\nasync function sha256Hex(s: string): Promise<string> {\r\n  const buf = new TextEncoder().encode(s);\r\n  const digest = await crypto.subtle.digest(\"SHA-256\", buf);\r\n  const bytes = new Uint8Array(digest);\r\n  return [...bytes].map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nexport class RoomDO implements DurableObject {\r\n  private state: DurableObjectState;\r\n  private env: unknown;\r\n\r\n  private sockets = new Map<string, WebSocket>(); // clientId -> socket\r\n  private roomSecretHash: string | null = null;\r\n\r\n  // Rate limiting: track message counts per client\r\n  private rateLimitCounts = new Map<string, { count: number; windowStart: number }>();\r\n\r\n  constructor(state: DurableObjectState, env: unknown) {\r\n    this.state = state;\r\n    this.env = env;\r\n  }\r\n\r\n  // ---- Rate limiting helper ----\r\n  private checkRateLimit(clientId: string): boolean {\r\n    const now = Date.now();\r\n    const entry = this.rateLimitCounts.get(clientId);\r\n\r\n    if (!entry || now - entry.windowStart > RATE_LIMIT_WINDOW_MS) {\r\n      // New window\r\n      this.rateLimitCounts.set(clientId, { count: 1, windowStart: now });\r\n      return true;\r\n    }\r\n\r\n    if (entry.count >= RATE_LIMIT_MAX_MSGS) {\r\n      return false; // Rate limited\r\n    }\r\n\r\n    entry.count++;\r\n    return true;\r\n  }\r\n\r\n  // ---- persistence helpers ----\r\n  private async load(): Promise<RoomState | null> {\r\n    const st = await this.state.storage.get<RoomState>(\"state\");\r\n    if (!st) return null;\r\n    return st;\r\n  }\r\n\r\n  private async save(st: RoomState) {\r\n    await this.state.storage.put(\"state\", st);\r\n  }\r\n\r\n  private async ensureAlarm(expiresAt: number) {\r\n    await this.state.storage.setAlarm(expiresAt);\r\n  }\r\n\r\n  async alarm() {\r\n    const st = await this.load();\r\n    if (!st) {\r\n      // No state means room was already cleaned up\r\n      return;\r\n    }\r\n\r\n    const currentTime = now();\r\n\r\n    // Check if room has expired\r\n    if (currentTime >= st.expiresAt) {\r\n      // Notify all connected clients that the room is expiring\r\n      const expiredMsg: ServerMsg = { type: \"finished\", reason: \"Room expired (24 hour limit)\" };\r\n      const payload = JSON.stringify(expiredMsg);\r\n      for (const [, ws] of this.sockets) {\r\n        try {\r\n          ws.send(payload);\r\n          ws.close(1000, \"Room expired\");\r\n        } catch {\r\n          // Socket may already be closed\r\n        }\r\n      }\r\n      this.sockets.clear();\r\n\r\n      // Clean up rate limit tracking\r\n      this.rateLimitCounts.clear();\r\n\r\n      // Delete all room data\r\n      await this.state.storage.deleteAll();\r\n    } else {\r\n      // Room hasn't expired yet - re-arm the alarm\r\n      // This handles edge cases where alarm fires slightly early\r\n      await this.ensureAlarm(st.expiresAt);\r\n    }\r\n  }\r\n\r\n  // ---- request router inside DO ----\r\n  async fetch(req: Request): Promise<Response> {\r\n    const url = new URL(req.url);\r\n\r\n    if (url.pathname === \"/init\" && req.method === \"POST\") {\r\n      const body = await req.json().catch(() => null) as any;\r\n      if (!body?.roomId || !body?.roomSecret) {\r\n        return new Response(\"Bad init\", { status: 400 });\r\n      }\r\n\r\n      const createdAt = now();\r\n      const expiresAt = createdAt + TTL_MS;\r\n      this.roomSecretHash = await sha256Hex(body.roomSecret);\r\n\r\n      const initial: RoomState = {\r\n        roomId: body.roomId,\r\n        createdAt,\r\n        expiresAt,\r\n\r\n        deck: { type: \"fibonacci\" },\r\n        funMode: true,\r\n\r\n        stories: [],\r\n        currentStoryId: null,\r\n\r\n        phase: \"voting\",\r\n        votesByStory: {},\r\n        lockedByStory: {},\r\n\r\n        participants: {},\r\n\r\n        chatMessages: [],\r\n      };\r\n\r\n      await this.state.storage.put(\"secretHash\", this.roomSecretHash);\r\n      await this.save(initial);\r\n      await this.ensureAlarm(expiresAt);\r\n\r\n      return new Response(\"OK\");\r\n    }\r\n\r\n    if (url.pathname === \"/state\" && req.method === \"GET\") {\r\n      const st = await this.load();\r\n      if (!st) return new Response(\"Not found\", { status: 404 });\r\n      const msg: ServerMsg = { type: \"state\", state: st, derived: this.derive(st) };\r\n      return new Response(JSON.stringify(msg), {\r\n        headers: { \"content-type\": \"application/json; charset=utf-8\" },\r\n      });\r\n    }\r\n\r\n    // WebSocket upgrade\r\n    if (req.headers.get(\"Upgrade\")?.toLowerCase() === \"websocket\") {\r\n      const pair = new WebSocketPair();\r\n      const client = pair[0];\r\n      const server = pair[1];\r\n\r\n      server.accept();\r\n\r\n      // generate clientId\r\n      const clientId = crypto.randomUUID();\r\n      this.sockets.set(clientId, server);\r\n\r\n      server.send(JSON.stringify({ type: \"hello\", clientId } satisfies ServerMsg));\r\n\r\n      // send current state snapshot\r\n      const st = await this.load();\r\n      if (st) server.send(JSON.stringify({ type: \"state\", state: st, derived: this.derive(st) } satisfies ServerMsg));\r\n\r\n      server.addEventListener(\"message\", (evt) => {\r\n        const data = typeof evt.data === \"string\" ? evt.data : \"\";\r\n        if (!data || data.length > MAX_MSG_BYTES) {\r\n          server.send(JSON.stringify({ type: \"error\", message: \"Message too large\" } satisfies ServerMsg));\r\n          return;\r\n        }\r\n\r\n        // Rate limiting check\r\n        if (!this.checkRateLimit(clientId)) {\r\n          server.send(JSON.stringify({ type: \"error\", message: \"Too many requests. Please slow down.\" } satisfies ServerMsg));\r\n          return;\r\n        }\r\n\r\n        const msg = safeJsonParse<ClientMsg>(data);\r\n        if (!msg?.type) {\r\n          server.send(JSON.stringify({ type: \"error\", message: \"Invalid message\" } satisfies ServerMsg));\r\n          return;\r\n        }\r\n        this.state.waitUntil(this.handleMessage(clientId, msg));\r\n      });\r\n\r\n      server.addEventListener(\"close\", () => {\r\n        this.sockets.delete(clientId);\r\n        this.state.waitUntil(this.onDisconnect(clientId));\r\n      });\r\n\r\n      return new Response(null, { status: 101, webSocket: client });\r\n    }\r\n\r\n    return new Response(\"Not found\", { status: 404 });\r\n  }\r\n\r\n  private async getSecretHash(): Promise<string | null> {\r\n    if (this.roomSecretHash) return this.roomSecretHash;\r\n    const h = await this.state.storage.get<string>(\"secretHash\");\r\n    this.roomSecretHash = h ?? null;\r\n    return this.roomSecretHash;\r\n  }\r\n\r\n  private async isHost(roomSecret?: string): Promise<boolean> {\r\n    if (!roomSecret) return false;\r\n    const h = await this.getSecretHash();\r\n    if (!h) return false;\r\n    const candidate = await sha256Hex(roomSecret);\r\n    return candidate === h;\r\n  }\r\n\r\n  private derive(st: RoomState): DerivedState {\r\n    const currentStory = st.currentStoryId\r\n      ? st.stories.find(s => s.id === st.currentStoryId) ?? null\r\n      : null;\r\n\r\n    const votes = (st.currentStoryId && st.votesByStory[st.currentStoryId])\r\n      ? Object.values(st.votesByStory[st.currentStoryId])\r\n      : [];\r\n\r\n    const numeric = votes.map(toNumberMaybe).filter((x): x is number => x !== null);\r\n\r\n    const stats = (st.phase !== \"voting\" && numeric.length > 0)\r\n      ? {\r\n          min: Math.min(...numeric),\r\n          max: Math.max(...numeric),\r\n          median: median(numeric),\r\n          spread: Math.max(...numeric) - Math.min(...numeric),\r\n        }\r\n      : null;\r\n\r\n    const waitingFor = Math.max(0, Object.keys(st.participants).length - votes.length);\r\n\r\n    return { currentStory, stats, waitingFor };\r\n  }\r\n\r\n  private broadcast(st: RoomState) {\r\n    const msg: ServerMsg = { type: \"state\", state: st, derived: this.derive(st) };\r\n    const payload = JSON.stringify(msg);\r\n    for (const [, ws] of this.sockets) {\r\n      try { ws.send(payload); } catch {}\r\n    }\r\n  }\r\n\r\n  private broadcastChat(chatMsg: ChatMessage) {\r\n    const msg: ServerMsg = { type: \"chat\", message: chatMsg };\r\n    const payload = JSON.stringify(msg);\r\n    for (const [, ws] of this.sockets) {\r\n      try { ws.send(payload); } catch {}\r\n    }\r\n  }\r\n\r\n  private async onDisconnect(clientId: string) {\r\n    const st = await this.load();\r\n    if (!st) return;\r\n    delete st.participants[clientId];\r\n\r\n    // also remove votes for this client\r\n    for (const storyId of Object.keys(st.votesByStory)) {\r\n      delete st.votesByStory[storyId]?.[clientId];\r\n    }\r\n\r\n    await this.save(st);\r\n    this.broadcast(st);\r\n  }\r\n\r\n  private async handleMessage(clientId: string, msg: ClientMsg) {\r\n    const st = await this.load();\r\n    if (!st) return;\r\n\r\n    // refresh TTL if active (optional)\r\n    // st.expiresAt = now() + TTL_MS; await this.ensureAlarm(st.expiresAt);\r\n\r\n    switch (msg.type) {\r\n      case \"join\": {\r\n        if (Object.keys(st.participants).length >= MAX_PARTICIPANTS) {\r\n          this.sendTo(clientId, { type: \"error\", message: `Room full (max ${MAX_PARTICIPANTS} participants)` });\r\n          return;\r\n        }\r\n        const name = (msg.name?.trim() || \"Anonymous\").slice(0, MAX_NAME_LEN);\r\n        const usedAvatars = Object.values(st.participants).map(p => p.avatar);\r\n        const avatar = getRandomAvatar(usedAvatars);\r\n        st.participants[clientId] = { name, avatar, joinedAt: now() };\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"setName\": {\r\n        const p = st.participants[clientId];\r\n        if (!p) return;\r\n        p.name = (msg.name.trim() || \"Anonymous\").slice(0, MAX_NAME_LEN);\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"setAvatar\": {\r\n        const p = st.participants[clientId];\r\n        if (!p) return;\r\n\r\n        const newAvatar = msg.avatar;\r\n\r\n        // Check if avatar is valid (in our list or a fallback)\r\n        if (!AVATARS.includes(newAvatar) && !newAvatar.startsWith(\"\uD83D\uDC64\")) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Invalid avatar\" });\r\n          return;\r\n        }\r\n\r\n        // Check if avatar is already in use by another participant\r\n        const otherParticipants = Object.entries(st.participants)\r\n          .filter(([id]) => id !== clientId);\r\n        const usedAvatars = otherParticipants.map(([, participant]) => participant.avatar);\r\n\r\n        if (usedAvatars.includes(newAvatar)) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"This avatar is already in use\" });\r\n          return;\r\n        }\r\n\r\n        p.avatar = newAvatar;\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"setDeck\": {\r\n        // host-only not required; keep simple (could restrict later)\r\n        if (msg.deck.type === \"custom\") {\r\n          const custom = (msg.deck.custom ?? []).map(s => s.trim()).filter(Boolean).slice(0, MAX_CUSTOM_DECK_SIZE);\r\n          st.deck = { type: \"custom\", custom };\r\n        } else {\r\n          st.deck = { type: msg.deck.type };\r\n        }\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"toggleFun\": {\r\n        st.funMode = !!msg.funMode;\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"addStory\": {\r\n        if (st.stories.length >= MAX_STORIES) {\r\n          this.sendTo(clientId, { type: \"error\", message: `Too many stories (max ${MAX_STORIES})` });\r\n          return;\r\n        }\r\n        const title = (msg.title?.trim() || \"\").slice(0, MAX_STORY_TITLE_LEN);\r\n        if (!title) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Story title required\" });\r\n          return;\r\n        }\r\n        const id = crypto.randomUUID();\r\n        st.stories.push({ id, title, notes: (msg.notes ?? \"\").slice(0, MAX_STORY_NOTES_LEN) || undefined });\r\n\r\n        if (!st.currentStoryId) {\r\n          st.currentStoryId = id;\r\n          st.phase = \"voting\";\r\n        }\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"editStory\": {\r\n        const story = st.stories.find(s => s.id === msg.storyId);\r\n        if (!story) return;\r\n\r\n        // Cannot edit a locked story\r\n        if (msg.storyId in st.lockedByStory) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Cannot edit a locked story\" });\r\n          return;\r\n        }\r\n\r\n        const newTitle = (msg.title?.trim() || \"\").slice(0, MAX_STORY_TITLE_LEN);\r\n        if (!newTitle) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Story title required\" });\r\n          return;\r\n        }\r\n\r\n        story.title = newTitle;\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"updateNotes\": {\r\n        const story = st.stories.find(s => s.id === msg.storyId);\r\n        if (!story) return;\r\n\r\n        // Cannot update notes on a locked story\r\n        if (msg.storyId in st.lockedByStory) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Cannot update notes on a locked story\" });\r\n          return;\r\n        }\r\n\r\n        // Must be a participant to update notes\r\n        if (!st.participants[clientId]) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Join the room first\" });\r\n          return;\r\n        }\r\n\r\n        story.notes = (msg.notes ?? \"\").slice(0, MAX_STORY_NOTES_LEN) || undefined;\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"deleteStory\": {\r\n        const storyIndex = st.stories.findIndex(s => s.id === msg.storyId);\r\n        if (storyIndex === -1) return;\r\n\r\n        // Cannot delete a locked story\r\n        if (msg.storyId in st.lockedByStory) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Cannot delete a locked story\" });\r\n          return;\r\n        }\r\n\r\n        // Remove the story\r\n        st.stories.splice(storyIndex, 1);\r\n\r\n        // Clean up votes for this story\r\n        delete st.votesByStory[msg.storyId];\r\n\r\n        // If this was the current story, move to next or clear\r\n        if (st.currentStoryId === msg.storyId) {\r\n          st.currentStoryId = st.stories[0]?.id ?? null;\r\n          st.phase = \"voting\";\r\n        }\r\n\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"setCurrentStory\": {\r\n        const exists = st.stories.some(s => s.id === msg.storyId);\r\n        if (!exists) return;\r\n        st.currentStoryId = msg.storyId;\r\n        st.phase = \"voting\";\r\n        // clear votes for the newly selected story? keep existing history, but voting phase resets\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"vote\": {\r\n        if (!st.currentStoryId || st.currentStoryId !== msg.storyId) return;\r\n        if (st.phase === \"locked\") return;\r\n\r\n        st.votesByStory[msg.storyId] ||= {};\r\n        st.votesByStory[msg.storyId][clientId] = String(msg.value).slice(0, MAX_VOTE_LEN);\r\n\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"reveal\": {\r\n        if (!(await this.isHost(msg.roomSecret))) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Host secret required\" });\r\n          return;\r\n        }\r\n        if (!st.currentStoryId) return;\r\n        st.phase = \"revealed\";\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"lock\": {\r\n        if (!(await this.isHost(msg.roomSecret))) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Host secret required\" });\r\n          return;\r\n        }\r\n        const exists = st.stories.some(s => s.id === msg.storyId);\r\n        if (!exists) return;\r\n        st.lockedByStory[msg.storyId] = String(msg.value).slice(0, MAX_VOTE_LEN);\r\n        st.phase = \"locked\";\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"clearVotes\": {\r\n        if (!(await this.isHost(msg.roomSecret))) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Host secret required\" });\r\n          return;\r\n        }\r\n        st.votesByStory[msg.storyId] = {};\r\n        st.phase = \"voting\";\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"next\": {\r\n        if (!(await this.isHost(msg.roomSecret))) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Host secret required\" });\r\n          return;\r\n        }\r\n        if (!st.currentStoryId) return;\r\n        const idx = st.stories.findIndex(s => s.id === st.currentStoryId);\r\n        const next = st.stories[idx + 1] ?? null;\r\n        st.currentStoryId = next?.id ?? st.currentStoryId;\r\n        st.phase = \"voting\";\r\n        await this.save(st);\r\n        this.broadcast(st);\r\n        return;\r\n      }\r\n\r\n      case \"chat\": {\r\n        // Must be a participant to chat\r\n        const participant = st.participants[clientId];\r\n        if (!participant) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Join the room first\" });\r\n          return;\r\n        }\r\n\r\n        const text = (msg.text?.trim() || \"\").slice(0, MAX_CHAT_MSG_LEN);\r\n        if (!text) return;\r\n\r\n        const chatMsg: ChatMessage = {\r\n          id: crypto.randomUUID(),\r\n          clientId,\r\n          name: participant.name,\r\n          text,\r\n          timestamp: now(),\r\n        };\r\n\r\n        // Keep last N messages\r\n        st.chatMessages.push(chatMsg);\r\n        if (st.chatMessages.length > MAX_CHAT_MESSAGES) {\r\n          st.chatMessages = st.chatMessages.slice(-MAX_CHAT_MESSAGES);\r\n        }\r\n\r\n        await this.save(st);\r\n        // Broadcast just the new chat message (more efficient)\r\n        this.broadcastChat(chatMsg);\r\n        return;\r\n      }\r\n\r\n      case \"finish\": {\r\n        if (!(await this.isHost(msg.roomSecret))) {\r\n          this.sendTo(clientId, { type: \"error\", message: \"Host secret required\" });\r\n          return;\r\n        }\r\n\r\n        // Notify all clients that the session is ending\r\n        const finishMsg: ServerMsg = { type: \"finished\", reason: \"Session ended by host\" };\r\n        const payload = JSON.stringify(finishMsg);\r\n        for (const [, ws] of this.sockets) {\r\n          try { ws.send(payload); } catch {}\r\n        }\r\n\r\n        // Close all WebSocket connections\r\n        for (const [, ws] of this.sockets) {\r\n          try { ws.close(1000, \"Session ended by host\"); } catch {}\r\n        }\r\n        this.sockets.clear();\r\n\r\n        // Delete all room data\r\n        await this.state.storage.deleteAll();\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  private sendTo(clientId: string, msg: ServerMsg) {\r\n    const ws = this.sockets.get(clientId);\r\n    if (!ws) return;\r\n    try { ws.send(JSON.stringify(msg)); } catch {}\r\n  }\r\n}\r\n", "import { nanoid } from \"nanoid\";\r\nimport { RoomDO } from \"./room-do\";\r\n\r\n// Re-export RoomDO for Wrangler to bind to\r\nexport { RoomDO };\r\n\r\nexport interface Env {\r\n  ROOMS: DurableObjectNamespace<RoomDO>;\r\n  ALLOWED_ORIGINS?: string; // comma-separated (e.g., \"https://sprintstorypoint.com\")\r\n}\r\n\r\nconst JSON_HEADERS = {\r\n  \"content-type\": \"application/json; charset=utf-8\",\r\n};\r\n\r\nfunction corsHeaders(req: Request, env: Env) {\r\n  const origin = req.headers.get(\"Origin\") ?? \"*\";\r\n\r\n  // In development (no ALLOWED_ORIGINS set), allow any origin\r\n  if (!env.ALLOWED_ORIGINS) {\r\n    return {\r\n      \"access-control-allow-origin\": origin,\r\n      \"access-control-allow-methods\": \"GET,POST,OPTIONS\",\r\n      \"access-control-allow-headers\": \"content-type\",\r\n      \"access-control-max-age\": \"86400\",\r\n    };\r\n  }\r\n\r\n  // In production, check against allowed list\r\n  const allowed = env.ALLOWED_ORIGINS.split(\",\").map(s => s.trim());\r\n  const allowOrigin = allowed.includes(origin) ? origin : allowed[0];\r\n\r\n  return {\r\n    \"access-control-allow-origin\": allowOrigin,\r\n    \"access-control-allow-methods\": \"GET,POST,OPTIONS\",\r\n    \"access-control-allow-headers\": \"content-type\",\r\n    \"access-control-max-age\": \"86400\",\r\n  };\r\n}\r\n\r\nfunction json(obj: unknown, req: Request, env: Env, status = 200) {\r\n  return new Response(JSON.stringify(obj), {\r\n    status,\r\n    headers: { ...JSON_HEADERS, ...corsHeaders(req, env) },\r\n  });\r\n}\r\n\r\nfunction bad(msg: string, req: Request, env: Env, status = 400) {\r\n  return json({ error: msg }, req, env, status);\r\n}\r\n\r\nexport default {\r\n  async fetch(req: Request, env: Env): Promise<Response> {\r\n    const url = new URL(req.url);\r\n\r\n    // CORS preflight\r\n    if (req.method === \"OPTIONS\") {\r\n      return new Response(null, { headers: corsHeaders(req, env) });\r\n    }\r\n\r\n    // Health\r\n    if (url.pathname === \"/api/health\") {\r\n      return json({ ok: true }, req, env);\r\n    }\r\n\r\n    // Create room\r\n    if (url.pathname === \"/api/rooms\" && req.method === \"POST\") {\r\n      // simple IP-based throttle hook (upgrade later to WAF rate rules)\r\n      const roomId = nanoid(12);\r\n      const roomSecret = nanoid(24);\r\n\r\n      const id = env.ROOMS.idFromName(roomId);\r\n      const stub = env.ROOMS.get(id);\r\n\r\n      await stub.fetch(\"https://do/init\", {\r\n        method: \"POST\",\r\n        headers: { \"content-type\": \"application/json\" },\r\n        body: JSON.stringify({ roomId, roomSecret }),\r\n      });\r\n\r\n      return json({ roomId, roomSecret }, req, env, 201);\r\n    }\r\n\r\n    // Room state (snapshot)\r\n    const stateMatch = url.pathname.match(/^\\/api\\/rooms\\/([A-Za-z0-9_-]{6,})\\/state$/);\r\n    if (stateMatch && req.method === \"GET\") {\r\n      const roomId = stateMatch[1];\r\n      const id = env.ROOMS.idFromName(roomId);\r\n      return env.ROOMS.get(id).fetch(\"https://do/state\");\r\n    }\r\n\r\n    // WebSocket endpoint -> forward to DO\r\n    const wsMatch = url.pathname.match(/^\\/api\\/rooms\\/([A-Za-z0-9_-]{6,})\\/ws$/);\r\n    if (wsMatch) {\r\n      if (req.headers.get(\"Upgrade\")?.toLowerCase() !== \"websocket\") {\r\n        return bad(\"Expected websocket upgrade\", req, env, 426);\r\n      }\r\n      const roomId = wsMatch[1];\r\n      const id = env.ROOMS.idFromName(roomId);\r\n      return env.ROOMS.get(id).fetch(req);\r\n    }\r\n\r\n    return new Response(\"Not found\", { status: 404 });\r\n  },\r\n};\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/mnt/c/Code/sprintstorypoint/worker/src/worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/mnt/c/Code/sprintstorypoint/worker/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/mnt/c/Code/sprintstorypoint/worker/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/mnt/c/Code/sprintstorypoint/worker/src/worker.ts\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/mnt/c/Code/sprintstorypoint/worker/.wrangler/tmp/bundle-05BlMp/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/mnt/c/Code/sprintstorypoint/worker/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/mnt/c/Code/sprintstorypoint/worker/.wrangler/tmp/bundle-05BlMp/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/mnt/c/Code/sprintstorypoint/worker/.wrangler/tmp/bundle-05BlMp/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": ";;;;AAAA,SAAS,0BAA0B,OAAO,MAAM;AAC/C,QAAM,UAAU,IAAI,QAAQ,OAAO,IAAI;AACvC,UAAQ,QAAQ,OAAO,kBAAkB;AACzC,SAAO;AACR;AAJS;AAMT,WAAW,QAAQ,IAAI,MAAM,WAAW,OAAO;AAAA,EAC9C,MAAM,QAAQ,SAAS,UAAU;AAChC,WAAO,QAAQ,MAAM,QAAQ,SAAS;AAAA,MACrC,0BAA0B,MAAM,MAAM,QAAQ;AAAA,IAC/C,CAAC;AAAA,EACF;AACD,CAAC;;;ACZM,IAAM,cACX;;;ACoBK,IAAI,SAAS,wBAAC,OAAO,OAAO;AACjC,MAAI,KAAK;AACT,MAAI,QAAQ,OAAO,gBAAgB,IAAI,WAAY,QAAQ,CAAE,CAAC;AAC9D,SAAO,QAAQ;AACb,UAAM,YAAkB,MAAM,IAAI,IAAI,EAAE;AAAA,EAC1C;AACA,SAAO;AACT,GAPoB;;;ACkDpB,IAAM,gBAAgB;AACtB,IAAM,mBAAmB;AACzB,IAAM,cAAc;AACpB,IAAM,oBAAoB;AAC1B,IAAM,sBAAsB;AAC5B,IAAM,sBAAsB;AAC5B,IAAM,mBAAmB;AACzB,IAAM,eAAe;AACrB,IAAM,eAAe;AACrB,IAAM,uBAAuB;AAC7B,IAAM,SAAS,KAAK,KAAK,KAAK;AAG9B,IAAM,uBAAuB;AAC7B,IAAM,sBAAsB;AAG5B,IAAM,UAAU;AAAA;AAAA,EAEd;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA;AAAA,EAEtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAK;AAAA,EACrD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAK;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA;AAAA,EAErD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAO;AAAA,EAAM;AAAA,EAAK;AAAA,EAAM;AAAA,EAAM;AAAA,EAAK;AAAA,EAAM;AAAA,EACrD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EACtD;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AAAA,EAAM;AACxD;AAEA,SAAS,gBAAgB,aAA+B;AACtD,QAAM,YAAY,QAAQ,OAAO,OAAK,CAAC,YAAY,SAAS,CAAC,CAAC;AAC9D,MAAI,UAAU,WAAW,GAAG;AAE1B,WAAO,YAAK,YAAY,SAAS;AAAA,EACnC;AACA,SAAO,UAAU,KAAK,MAAM,KAAK,OAAO,IAAI,UAAU,MAAM,CAAC;AAC/D;AAPS;AAST,SAAS,MAAM;AACb,SAAO,KAAK,IAAI;AAClB;AAFS;AAIT,SAAS,cAAiB,MAAwB;AAChD,MAAI;AAAE,WAAO,KAAK,MAAM,IAAI;AAAA,EAAQ,QAAE;AAAQ,WAAO;AAAA,EAAM;AAC7D;AAFS;AAIT,SAAS,OAAO,MAAgB;AAC9B,QAAM,IAAI,CAAC,GAAG,IAAI,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AACxC,QAAM,MAAM,KAAK,MAAM,EAAE,SAAS,CAAC;AACnC,SAAO,EAAE,SAAS,IAAI,EAAE,GAAG,KAAK,EAAE,MAAM,CAAC,IAAI,EAAE,GAAG,KAAK;AACzD;AAJS;AAMT,SAAS,cAAc,GAA0B;AAE/C,QAAM,IAAI,OAAO,CAAC;AAClB,SAAO,OAAO,SAAS,CAAC,IAAI,IAAI;AAClC;AAJS;AAMT,eAAe,UAAU,GAA4B;AACnD,QAAM,MAAM,IAAI,YAAY,EAAE,OAAO,CAAC;AACtC,QAAM,SAAS,MAAM,OAAO,OAAO,OAAO,WAAW,GAAG;AACxD,QAAM,QAAQ,IAAI,WAAW,MAAM;AACnC,SAAO,CAAC,GAAG,KAAK,EAAE,IAAI,OAAK,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAAE,KAAK,EAAE;AACrE;AALe;AAOR,IAAM,SAAN,MAAsC;AAAA,EACnC;AAAA,EACA;AAAA,EAEA,UAAU,oBAAI,IAAuB;AAAA;AAAA,EACrC,iBAAgC;AAAA;AAAA,EAGhC,kBAAkB,oBAAI,IAAoD;AAAA,EAElF,YAAY,OAA2B,KAAc;AACnD,SAAK,QAAQ;AACb,SAAK,MAAM;AAAA,EACb;AAAA;AAAA,EAGQ,eAAe,UAA2B;AAChD,UAAMA,OAAM,KAAK,IAAI;AACrB,UAAM,QAAQ,KAAK,gBAAgB,IAAI,QAAQ;AAE/C,QAAI,CAAC,SAASA,OAAM,MAAM,cAAc,sBAAsB;AAE5D,WAAK,gBAAgB,IAAI,UAAU,EAAE,OAAO,GAAG,aAAaA,KAAI,CAAC;AACjE,aAAO;AAAA,IACT;AAEA,QAAI,MAAM,SAAS,qBAAqB;AACtC,aAAO;AAAA,IACT;AAEA,UAAM;AACN,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,MAAc,OAAkC;AAC9C,UAAM,KAAK,MAAM,KAAK,MAAM,QAAQ,IAAe,OAAO;AAC1D,QAAI,CAAC;AAAI,aAAO;AAChB,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,KAAK,IAAe;AAChC,UAAM,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE;AAAA,EAC1C;AAAA,EAEA,MAAc,YAAY,WAAmB;AAC3C,UAAM,KAAK,MAAM,QAAQ,SAAS,SAAS;AAAA,EAC7C;AAAA,EAEA,MAAM,QAAQ;AACZ,UAAM,KAAK,MAAM,KAAK,KAAK;AAC3B,QAAI,CAAC,IAAI;AAEP;AAAA,IACF;AAEA,UAAM,cAAc,IAAI;AAGxB,QAAI,eAAe,GAAG,WAAW;AAE/B,YAAM,aAAwB,EAAE,MAAM,YAAY,QAAQ,+BAA+B;AACzF,YAAM,UAAU,KAAK,UAAU,UAAU;AACzC,iBAAW,CAAC,EAAE,EAAE,KAAK,KAAK,SAAS;AACjC,YAAI;AACF,aAAG,KAAK,OAAO;AACf,aAAG,MAAM,KAAM,cAAc;AAAA,QAC/B,QAAE;AAAA,QAEF;AAAA,MACF;AACA,WAAK,QAAQ,MAAM;AAGnB,WAAK,gBAAgB,MAAM;AAG3B,YAAM,KAAK,MAAM,QAAQ,UAAU;AAAA,IACrC,OAAO;AAGL,YAAM,KAAK,YAAY,GAAG,SAAS;AAAA,IACrC;AAAA,EACF;AAAA;AAAA,EAGA,MAAM,MAAM,KAAiC;AAC3C,UAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAE3B,QAAI,IAAI,aAAa,WAAW,IAAI,WAAW,QAAQ;AACrD,YAAM,OAAO,MAAM,IAAI,KAAK,EAAE,MAAM,MAAM,IAAI;AAC9C,UAAI,CAAC,MAAM,UAAU,CAAC,MAAM,YAAY;AACtC,eAAO,IAAI,SAAS,YAAY,EAAE,QAAQ,IAAI,CAAC;AAAA,MACjD;AAEA,YAAM,YAAY,IAAI;AACtB,YAAM,YAAY,YAAY;AAC9B,WAAK,iBAAiB,MAAM,UAAU,KAAK,UAAU;AAErD,YAAM,UAAqB;AAAA,QACzB,QAAQ,KAAK;AAAA,QACb;AAAA,QACA;AAAA,QAEA,MAAM,EAAE,MAAM,YAAY;AAAA,QAC1B,SAAS;AAAA,QAET,SAAS,CAAC;AAAA,QACV,gBAAgB;AAAA,QAEhB,OAAO;AAAA,QACP,cAAc,CAAC;AAAA,QACf,eAAe,CAAC;AAAA,QAEhB,cAAc,CAAC;AAAA,QAEf,cAAc,CAAC;AAAA,MACjB;AAEA,YAAM,KAAK,MAAM,QAAQ,IAAI,cAAc,KAAK,cAAc;AAC9D,YAAM,KAAK,KAAK,OAAO;AACvB,YAAM,KAAK,YAAY,SAAS;AAEhC,aAAO,IAAI,SAAS,IAAI;AAAA,IAC1B;AAEA,QAAI,IAAI,aAAa,YAAY,IAAI,WAAW,OAAO;AACrD,YAAM,KAAK,MAAM,KAAK,KAAK;AAC3B,UAAI,CAAC;AAAI,eAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AACzD,YAAM,MAAiB,EAAE,MAAM,SAAS,OAAO,IAAI,SAAS,KAAK,OAAO,EAAE,EAAE;AAC5E,aAAO,IAAI,SAAS,KAAK,UAAU,GAAG,GAAG;AAAA,QACvC,SAAS,EAAE,gBAAgB,kCAAkC;AAAA,MAC/D,CAAC;AAAA,IACH;AAGA,QAAI,IAAI,QAAQ,IAAI,SAAS,GAAG,YAAY,MAAM,aAAa;AAC7D,YAAM,OAAO,IAAI,cAAc;AAC/B,YAAM,SAAS,KAAK,CAAC;AACrB,YAAM,SAAS,KAAK,CAAC;AAErB,aAAO,OAAO;AAGd,YAAM,WAAW,OAAO,WAAW;AACnC,WAAK,QAAQ,IAAI,UAAU,MAAM;AAEjC,aAAO,KAAK,KAAK,UAAU,EAAE,MAAM,SAAS,SAAS,CAAqB,CAAC;AAG3E,YAAM,KAAK,MAAM,KAAK,KAAK;AAC3B,UAAI;AAAI,eAAO,KAAK,KAAK,UAAU,EAAE,MAAM,SAAS,OAAO,IAAI,SAAS,KAAK,OAAO,EAAE,EAAE,CAAqB,CAAC;AAE9G,aAAO,iBAAiB,WAAW,CAAC,QAAQ;AAC1C,cAAM,OAAO,OAAO,IAAI,SAAS,WAAW,IAAI,OAAO;AACvD,YAAI,CAAC,QAAQ,KAAK,SAAS,eAAe;AACxC,iBAAO,KAAK,KAAK,UAAU,EAAE,MAAM,SAAS,SAAS,oBAAoB,CAAqB,CAAC;AAC/F;AAAA,QACF;AAGA,YAAI,CAAC,KAAK,eAAe,QAAQ,GAAG;AAClC,iBAAO,KAAK,KAAK,UAAU,EAAE,MAAM,SAAS,SAAS,uCAAuC,CAAqB,CAAC;AAClH;AAAA,QACF;AAEA,cAAM,MAAM,cAAyB,IAAI;AACzC,YAAI,CAAC,KAAK,MAAM;AACd,iBAAO,KAAK,KAAK,UAAU,EAAE,MAAM,SAAS,SAAS,kBAAkB,CAAqB,CAAC;AAC7F;AAAA,QACF;AACA,aAAK,MAAM,UAAU,KAAK,cAAc,UAAU,GAAG,CAAC;AAAA,MACxD,CAAC;AAED,aAAO,iBAAiB,SAAS,MAAM;AACrC,aAAK,QAAQ,OAAO,QAAQ;AAC5B,aAAK,MAAM,UAAU,KAAK,aAAa,QAAQ,CAAC;AAAA,MAClD,CAAC;AAED,aAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK,WAAW,OAAO,CAAC;AAAA,IAC9D;AAEA,WAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,EAClD;AAAA,EAEA,MAAc,gBAAwC;AACpD,QAAI,KAAK;AAAgB,aAAO,KAAK;AACrC,UAAM,IAAI,MAAM,KAAK,MAAM,QAAQ,IAAY,YAAY;AAC3D,SAAK,iBAAiB,KAAK;AAC3B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,MAAc,OAAO,YAAuC;AAC1D,QAAI,CAAC;AAAY,aAAO;AACxB,UAAM,IAAI,MAAM,KAAK,cAAc;AACnC,QAAI,CAAC;AAAG,aAAO;AACf,UAAM,YAAY,MAAM,UAAU,UAAU;AAC5C,WAAO,cAAc;AAAA,EACvB;AAAA,EAEQ,OAAO,IAA6B;AAC1C,UAAM,eAAe,GAAG,iBACpB,GAAG,QAAQ,KAAK,OAAK,EAAE,OAAO,GAAG,cAAc,KAAK,OACpD;AAEJ,UAAM,QAAS,GAAG,kBAAkB,GAAG,aAAa,GAAG,cAAc,IACjE,OAAO,OAAO,GAAG,aAAa,GAAG,cAAc,CAAC,IAChD,CAAC;AAEL,UAAM,UAAU,MAAM,IAAI,aAAa,EAAE,OAAO,CAAC,MAAmB,MAAM,IAAI;AAE9E,UAAM,QAAS,GAAG,UAAU,YAAY,QAAQ,SAAS,IACrD;AAAA,MACE,KAAK,KAAK,IAAI,GAAG,OAAO;AAAA,MACxB,KAAK,KAAK,IAAI,GAAG,OAAO;AAAA,MACxB,QAAQ,OAAO,OAAO;AAAA,MACtB,QAAQ,KAAK,IAAI,GAAG,OAAO,IAAI,KAAK,IAAI,GAAG,OAAO;AAAA,IACpD,IACA;AAEJ,UAAM,aAAa,KAAK,IAAI,GAAG,OAAO,KAAK,GAAG,YAAY,EAAE,SAAS,MAAM,MAAM;AAEjF,WAAO,EAAE,cAAc,OAAO,WAAW;AAAA,EAC3C;AAAA,EAEQ,UAAU,IAAe;AAC/B,UAAM,MAAiB,EAAE,MAAM,SAAS,OAAO,IAAI,SAAS,KAAK,OAAO,EAAE,EAAE;AAC5E,UAAM,UAAU,KAAK,UAAU,GAAG;AAClC,eAAW,CAAC,EAAE,EAAE,KAAK,KAAK,SAAS;AACjC,UAAI;AAAE,WAAG,KAAK,OAAO;AAAA,MAAG,QAAE;AAAA,MAAO;AAAA,IACnC;AAAA,EACF;AAAA,EAEQ,cAAc,SAAsB;AAC1C,UAAM,MAAiB,EAAE,MAAM,QAAQ,SAAS,QAAQ;AACxD,UAAM,UAAU,KAAK,UAAU,GAAG;AAClC,eAAW,CAAC,EAAE,EAAE,KAAK,KAAK,SAAS;AACjC,UAAI;AAAE,WAAG,KAAK,OAAO;AAAA,MAAG,QAAE;AAAA,MAAO;AAAA,IACnC;AAAA,EACF;AAAA,EAEA,MAAc,aAAa,UAAkB;AAC3C,UAAM,KAAK,MAAM,KAAK,KAAK;AAC3B,QAAI,CAAC;AAAI;AACT,WAAO,GAAG,aAAa,QAAQ;AAG/B,eAAW,WAAW,OAAO,KAAK,GAAG,YAAY,GAAG;AAClD,aAAO,GAAG,aAAa,OAAO,IAAI,QAAQ;AAAA,IAC5C;AAEA,UAAM,KAAK,KAAK,EAAE;AAClB,SAAK,UAAU,EAAE;AAAA,EACnB;AAAA,EAEA,MAAc,cAAc,UAAkB,KAAgB;AAC5D,UAAM,KAAK,MAAM,KAAK,KAAK;AAC3B,QAAI,CAAC;AAAI;AAKT,YAAQ,IAAI,MAAM;AAAA,MAChB,KAAK,QAAQ;AACX,YAAI,OAAO,KAAK,GAAG,YAAY,EAAE,UAAU,kBAAkB;AAC3D,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,kBAAkB,iCAAiC,CAAC;AACpG;AAAA,QACF;AACA,cAAM,QAAQ,IAAI,MAAM,KAAK,KAAK,aAAa,MAAM,GAAG,YAAY;AACpE,cAAM,cAAc,OAAO,OAAO,GAAG,YAAY,EAAE,IAAI,OAAK,EAAE,MAAM;AACpE,cAAM,SAAS,gBAAgB,WAAW;AAC1C,WAAG,aAAa,QAAQ,IAAI,EAAE,MAAM,QAAQ,UAAU,IAAI,EAAE;AAC5D,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,WAAW;AACd,cAAM,IAAI,GAAG,aAAa,QAAQ;AAClC,YAAI,CAAC;AAAG;AACR,UAAE,QAAQ,IAAI,KAAK,KAAK,KAAK,aAAa,MAAM,GAAG,YAAY;AAC/D,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,aAAa;AAChB,cAAM,IAAI,GAAG,aAAa,QAAQ;AAClC,YAAI,CAAC;AAAG;AAER,cAAM,YAAY,IAAI;AAGtB,YAAI,CAAC,QAAQ,SAAS,SAAS,KAAK,CAAC,UAAU,WAAW,WAAI,GAAG;AAC/D,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,iBAAiB,CAAC;AAClE;AAAA,QACF;AAGA,cAAM,oBAAoB,OAAO,QAAQ,GAAG,YAAY,EACrD,OAAO,CAAC,CAAC,EAAE,MAAM,OAAO,QAAQ;AACnC,cAAM,cAAc,kBAAkB,IAAI,CAAC,CAAC,EAAE,WAAW,MAAM,YAAY,MAAM;AAEjF,YAAI,YAAY,SAAS,SAAS,GAAG;AACnC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,gCAAgC,CAAC;AACjF;AAAA,QACF;AAEA,UAAE,SAAS;AACX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,WAAW;AAEd,YAAI,IAAI,KAAK,SAAS,UAAU;AAC9B,gBAAM,UAAU,IAAI,KAAK,UAAU,CAAC,GAAG,IAAI,OAAK,EAAE,KAAK,CAAC,EAAE,OAAO,OAAO,EAAE,MAAM,GAAG,oBAAoB;AACvG,aAAG,OAAO,EAAE,MAAM,UAAU,OAAO;AAAA,QACrC,OAAO;AACL,aAAG,OAAO,EAAE,MAAM,IAAI,KAAK,KAAK;AAAA,QAClC;AACA,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,aAAa;AAChB,WAAG,UAAU,CAAC,CAAC,IAAI;AACnB,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,YAAY;AACf,YAAI,GAAG,QAAQ,UAAU,aAAa;AACpC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,yBAAyB,eAAe,CAAC;AACzF;AAAA,QACF;AACA,cAAM,SAAS,IAAI,OAAO,KAAK,KAAK,IAAI,MAAM,GAAG,mBAAmB;AACpE,YAAI,CAAC,OAAO;AACV,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AACA,cAAM,KAAK,OAAO,WAAW;AAC7B,WAAG,QAAQ,KAAK,EAAE,IAAI,OAAO,QAAQ,IAAI,SAAS,IAAI,MAAM,GAAG,mBAAmB,KAAK,OAAU,CAAC;AAElG,YAAI,CAAC,GAAG,gBAAgB;AACtB,aAAG,iBAAiB;AACpB,aAAG,QAAQ;AAAA,QACb;AACA,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,aAAa;AAChB,cAAM,QAAQ,GAAG,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO;AACvD,YAAI,CAAC;AAAO;AAGZ,YAAI,IAAI,WAAW,GAAG,eAAe;AACnC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,6BAA6B,CAAC;AAC9E;AAAA,QACF;AAEA,cAAM,YAAY,IAAI,OAAO,KAAK,KAAK,IAAI,MAAM,GAAG,mBAAmB;AACvE,YAAI,CAAC,UAAU;AACb,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AAEA,cAAM,QAAQ;AACd,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,eAAe;AAClB,cAAM,QAAQ,GAAG,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO;AACvD,YAAI,CAAC;AAAO;AAGZ,YAAI,IAAI,WAAW,GAAG,eAAe;AACnC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,wCAAwC,CAAC;AACzF;AAAA,QACF;AAGA,YAAI,CAAC,GAAG,aAAa,QAAQ,GAAG;AAC9B,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,sBAAsB,CAAC;AACvE;AAAA,QACF;AAEA,cAAM,SAAS,IAAI,SAAS,IAAI,MAAM,GAAG,mBAAmB,KAAK;AACjE,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,eAAe;AAClB,cAAM,aAAa,GAAG,QAAQ,UAAU,OAAK,EAAE,OAAO,IAAI,OAAO;AACjE,YAAI,eAAe;AAAI;AAGvB,YAAI,IAAI,WAAW,GAAG,eAAe;AACnC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,+BAA+B,CAAC;AAChF;AAAA,QACF;AAGA,WAAG,QAAQ,OAAO,YAAY,CAAC;AAG/B,eAAO,GAAG,aAAa,IAAI,OAAO;AAGlC,YAAI,GAAG,mBAAmB,IAAI,SAAS;AACrC,aAAG,iBAAiB,GAAG,QAAQ,CAAC,GAAG,MAAM;AACzC,aAAG,QAAQ;AAAA,QACb;AAEA,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,mBAAmB;AACtB,cAAM,SAAS,GAAG,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO;AACxD,YAAI,CAAC;AAAQ;AACb,WAAG,iBAAiB,IAAI;AACxB,WAAG,QAAQ;AAEX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,QAAQ;AACX,YAAI,CAAC,GAAG,kBAAkB,GAAG,mBAAmB,IAAI;AAAS;AAC7D,YAAI,GAAG,UAAU;AAAU;AAE3B,WAAG,aAAa,IAAI,OAAO,MAAM,CAAC;AAClC,WAAG,aAAa,IAAI,OAAO,EAAE,QAAQ,IAAI,OAAO,IAAI,KAAK,EAAE,MAAM,GAAG,YAAY;AAEhF,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,UAAU;AACb,YAAI,CAAE,MAAM,KAAK,OAAO,IAAI,UAAU,GAAI;AACxC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AACA,YAAI,CAAC,GAAG;AAAgB;AACxB,WAAG,QAAQ;AACX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,QAAQ;AACX,YAAI,CAAE,MAAM,KAAK,OAAO,IAAI,UAAU,GAAI;AACxC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AACA,cAAM,SAAS,GAAG,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO;AACxD,YAAI,CAAC;AAAQ;AACb,WAAG,cAAc,IAAI,OAAO,IAAI,OAAO,IAAI,KAAK,EAAE,MAAM,GAAG,YAAY;AACvE,WAAG,QAAQ;AACX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,cAAc;AACjB,YAAI,CAAE,MAAM,KAAK,OAAO,IAAI,UAAU,GAAI;AACxC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AACA,WAAG,aAAa,IAAI,OAAO,IAAI,CAAC;AAChC,WAAG,QAAQ;AACX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,QAAQ;AACX,YAAI,CAAE,MAAM,KAAK,OAAO,IAAI,UAAU,GAAI;AACxC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AACA,YAAI,CAAC,GAAG;AAAgB;AACxB,cAAM,MAAM,GAAG,QAAQ,UAAU,OAAK,EAAE,OAAO,GAAG,cAAc;AAChE,cAAM,OAAO,GAAG,QAAQ,MAAM,CAAC,KAAK;AACpC,WAAG,iBAAiB,MAAM,MAAM,GAAG;AACnC,WAAG,QAAQ;AACX,cAAM,KAAK,KAAK,EAAE;AAClB,aAAK,UAAU,EAAE;AACjB;AAAA,MACF;AAAA,MAEA,KAAK,QAAQ;AAEX,cAAM,cAAc,GAAG,aAAa,QAAQ;AAC5C,YAAI,CAAC,aAAa;AAChB,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,sBAAsB,CAAC;AACvE;AAAA,QACF;AAEA,cAAM,QAAQ,IAAI,MAAM,KAAK,KAAK,IAAI,MAAM,GAAG,gBAAgB;AAC/D,YAAI,CAAC;AAAM;AAEX,cAAM,UAAuB;AAAA,UAC3B,IAAI,OAAO,WAAW;AAAA,UACtB;AAAA,UACA,MAAM,YAAY;AAAA,UAClB;AAAA,UACA,WAAW,IAAI;AAAA,QACjB;AAGA,WAAG,aAAa,KAAK,OAAO;AAC5B,YAAI,GAAG,aAAa,SAAS,mBAAmB;AAC9C,aAAG,eAAe,GAAG,aAAa,MAAM,CAAC,iBAAiB;AAAA,QAC5D;AAEA,cAAM,KAAK,KAAK,EAAE;AAElB,aAAK,cAAc,OAAO;AAC1B;AAAA,MACF;AAAA,MAEA,KAAK,UAAU;AACb,YAAI,CAAE,MAAM,KAAK,OAAO,IAAI,UAAU,GAAI;AACxC,eAAK,OAAO,UAAU,EAAE,MAAM,SAAS,SAAS,uBAAuB,CAAC;AACxE;AAAA,QACF;AAGA,cAAM,YAAuB,EAAE,MAAM,YAAY,QAAQ,wBAAwB;AACjF,cAAM,UAAU,KAAK,UAAU,SAAS;AACxC,mBAAW,CAAC,EAAE,EAAE,KAAK,KAAK,SAAS;AACjC,cAAI;AAAE,eAAG,KAAK,OAAO;AAAA,UAAG,QAAE;AAAA,UAAO;AAAA,QACnC;AAGA,mBAAW,CAAC,EAAE,EAAE,KAAK,KAAK,SAAS;AACjC,cAAI;AAAE,eAAG,MAAM,KAAM,uBAAuB;AAAA,UAAG,QAAE;AAAA,UAAO;AAAA,QAC1D;AACA,aAAK,QAAQ,MAAM;AAGnB,cAAM,KAAK,MAAM,QAAQ,UAAU;AACnC;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEQ,OAAO,UAAkB,KAAgB;AAC/C,UAAM,KAAK,KAAK,QAAQ,IAAI,QAAQ;AACpC,QAAI,CAAC;AAAI;AACT,QAAI;AAAE,SAAG,KAAK,KAAK,UAAU,GAAG,CAAC;AAAA,IAAG,QAAE;AAAA,IAAO;AAAA,EAC/C;AACF;AArjBa;;;ACnIb,IAAM,eAAe;AAAA,EACnB,gBAAgB;AAClB;AAEA,SAAS,YAAY,KAAc,KAAU;AAC3C,QAAM,SAAS,IAAI,QAAQ,IAAI,QAAQ,KAAK;AAG5C,MAAI,CAAC,IAAI,iBAAiB;AACxB,WAAO;AAAA,MACL,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,0BAA0B;AAAA,IAC5B;AAAA,EACF;AAGA,QAAM,UAAU,IAAI,gBAAgB,MAAM,GAAG,EAAE,IAAI,OAAK,EAAE,KAAK,CAAC;AAChE,QAAM,cAAc,QAAQ,SAAS,MAAM,IAAI,SAAS,QAAQ,CAAC;AAEjE,SAAO;AAAA,IACL,+BAA+B;AAAA,IAC/B,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,IAChC,0BAA0B;AAAA,EAC5B;AACF;AAvBS;AAyBT,SAAS,KAAK,KAAc,KAAc,KAAU,SAAS,KAAK;AAChE,SAAO,IAAI,SAAS,KAAK,UAAU,GAAG,GAAG;AAAA,IACvC;AAAA,IACA,SAAS,EAAE,GAAG,cAAc,GAAG,YAAY,KAAK,GAAG,EAAE;AAAA,EACvD,CAAC;AACH;AALS;AAOT,SAAS,IAAI,KAAa,KAAc,KAAU,SAAS,KAAK;AAC9D,SAAO,KAAK,EAAE,OAAO,IAAI,GAAG,KAAK,KAAK,MAAM;AAC9C;AAFS;AAIT,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,KAAc,KAA6B;AACrD,UAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAG3B,QAAI,IAAI,WAAW,WAAW;AAC5B,aAAO,IAAI,SAAS,MAAM,EAAE,SAAS,YAAY,KAAK,GAAG,EAAE,CAAC;AAAA,IAC9D;AAGA,QAAI,IAAI,aAAa,eAAe;AAClC,aAAO,KAAK,EAAE,IAAI,KAAK,GAAG,KAAK,GAAG;AAAA,IACpC;AAGA,QAAI,IAAI,aAAa,gBAAgB,IAAI,WAAW,QAAQ;AAE1D,YAAM,SAAS,OAAO,EAAE;AACxB,YAAM,aAAa,OAAO,EAAE;AAE5B,YAAM,KAAK,IAAI,MAAM,WAAW,MAAM;AACtC,YAAM,OAAO,IAAI,MAAM,IAAI,EAAE;AAE7B,YAAM,KAAK,MAAM,mBAAmB;AAAA,QAClC,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU,EAAE,QAAQ,WAAW,CAAC;AAAA,MAC7C,CAAC;AAED,aAAO,KAAK,EAAE,QAAQ,WAAW,GAAG,KAAK,KAAK,GAAG;AAAA,IACnD;AAGA,UAAM,aAAa,IAAI,SAAS,MAAM,4CAA4C;AAClF,QAAI,cAAc,IAAI,WAAW,OAAO;AACtC,YAAM,SAAS,WAAW,CAAC;AAC3B,YAAM,KAAK,IAAI,MAAM,WAAW,MAAM;AACtC,aAAO,IAAI,MAAM,IAAI,EAAE,EAAE,MAAM,kBAAkB;AAAA,IACnD;AAGA,UAAM,UAAU,IAAI,SAAS,MAAM,yCAAyC;AAC5E,QAAI,SAAS;AACX,UAAI,IAAI,QAAQ,IAAI,SAAS,GAAG,YAAY,MAAM,aAAa;AAC7D,eAAO,IAAI,8BAA8B,KAAK,KAAK,GAAG;AAAA,MACxD;AACA,YAAM,SAAS,QAAQ,CAAC;AACxB,YAAM,KAAK,IAAI,MAAM,WAAW,MAAM;AACtC,aAAO,IAAI,MAAM,IAAI,EAAE,EAAE,MAAM,GAAG;AAAA,IACpC;AAEA,WAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,EAClD;AACF;;;ACtGA,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,UAAE;AACD,QAAI;AACH,UAAI,QAAQ,SAAS,QAAQ,CAAC,QAAQ,UAAU;AAC/C,cAAM,SAAS,QAAQ,KAAK,UAAU;AACtC,eAAO,EAAE,MAAM,OAAO,KAAK,GAAG,MAAM;AAAA,QAAC;AAAA,MACtC;AAAA,IACD,SAAS,GAAP;AACD,cAAQ,MAAM,4CAA4C,CAAC;AAAA,IAC5D;AAAA,EACD;AACD,GAb8B;AAe9B,IAAO,6CAAQ;;;ACRf,SAAS,YAAY,GAAmB;AACvC,SAAO;AAAA,IACN,MAAM,GAAG;AAAA,IACT,SAAS,GAAG,WAAW,OAAO,CAAC;AAAA,IAC/B,OAAO,GAAG;AAAA,IACV,OAAO,GAAG,UAAU,SAAY,SAAY,YAAY,EAAE,KAAK;AAAA,EAChE;AACD;AAPS;AAUT,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,SAAS,GAAP;AACD,UAAM,QAAQ,YAAY,CAAC;AAC3B,WAAO,SAAS,KAAK,OAAO;AAAA,MAC3B,QAAQ;AAAA,MACR,SAAS,EAAE,+BAA+B,OAAO;AAAA,IAClD,CAAC;AAAA,EACF;AACD,GAV8B;AAY9B,IAAO,2CAAQ;;;ACzBJ,IAAM,mCAAmC;AAAA,EAE9B;AAAA,EAAyB;AAC3C;AACA,IAAO,sCAAQ;;;ACcnB,IAAM,wBAAsC,CAAC;AAKtC,SAAS,uBAAuB,MAAqC;AAC3E,wBAAsB,KAAK,GAAG,KAAK,KAAK,CAAC;AAC1C;AAFgB;AAShB,SAAS,uBACR,SACA,KACA,KACA,UACA,iBACsB;AACtB,QAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACxB,QAAM,gBAAmC;AAAA,IACxC;AAAA,IACA,KAAK,YAAY,QAAQ;AACxB,aAAO,uBAAuB,YAAY,QAAQ,KAAK,UAAU,IAAI;AAAA,IACtE;AAAA,EACD;AACA,SAAO,KAAK,SAAS,KAAK,KAAK,aAAa;AAC7C;AAfS;AAiBF,SAAS,kBACf,SACA,KACA,KACA,UACA,iBACsB;AACtB,SAAO,uBAAuB,SAAS,KAAK,KAAK,UAAU;AAAA,IAC1D,GAAG;AAAA,IACH;AAAA,EACD,CAAC;AACF;AAXgB;;;AC3ChB,IAAM,iCAAN,MAAoE;AAAA,EAGnE,YACU,eACA,MACT,SACC;AAHQ;AACA;AAGT,SAAK,WAAW;AAAA,EACjB;AAAA,EARS;AAAA,EAUT,UAAU;AACT,QAAI,EAAE,gBAAgB,iCAAiC;AACtD,YAAM,IAAI,UAAU,oBAAoB;AAAA,IACzC;AAEA,SAAK,SAAS;AAAA,EACf;AACD;AAlBM;AAoBN,SAAS,oBAAoB,QAA0C;AAEtE,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAEA,QAAM,kBAA+C,gCACpD,SACA,KACA,KACC;AACD,QAAI,OAAO,UAAU,QAAW;AAC/B,YAAM,IAAI,MAAM,6CAA6C;AAAA,IAC9D;AACA,WAAO,OAAO,MAAM,SAAS,KAAK,GAAG;AAAA,EACtC,GATqD;AAWrD,SAAO;AAAA,IACN,GAAG;AAAA,IACH,MAAM,SAAS,KAAK,KAAK;AACxB,YAAM,aAAyB,gCAAU,MAAM,MAAM;AACpD,YAAI,SAAS,eAAe,OAAO,cAAc,QAAW;AAC3D,gBAAM,aAAa,IAAI;AAAA,YACtB,KAAK,IAAI;AAAA,YACT,KAAK,QAAQ;AAAA,YACb,MAAM;AAAA,YAAC;AAAA,UACR;AACA,iBAAO,OAAO,UAAU,YAAY,KAAK,GAAG;AAAA,QAC7C;AAAA,MACD,GAT+B;AAU/B,aAAO,kBAAkB,SAAS,KAAK,KAAK,YAAY,eAAe;AAAA,IACxE;AAAA,EACD;AACD;AAxCS;AA0CT,SAAS,qBACR,OAC8B;AAE9B,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAGA,SAAO,cAAc,MAAM;AAAA,IAC1B,mBAAyE,CACxE,SACA,KACA,QACI;AACJ,WAAK,MAAM;AACX,WAAK,MAAM;AACX,UAAI,MAAM,UAAU,QAAW;AAC9B,cAAM,IAAI,MAAM,sDAAsD;AAAA,MACvE;AACA,aAAO,MAAM,MAAM,OAAO;AAAA,IAC3B;AAAA,IAEA,cAA0B,CAAC,MAAM,SAAS;AACzC,UAAI,SAAS,eAAe,MAAM,cAAc,QAAW;AAC1D,cAAM,aAAa,IAAI;AAAA,UACtB,KAAK,IAAI;AAAA,UACT,KAAK,QAAQ;AAAA,UACb,MAAM;AAAA,UAAC;AAAA,QACR;AACA,eAAO,MAAM,UAAU,UAAU;AAAA,MAClC;AAAA,IACD;AAAA,IAEA,MAAM,SAAwD;AAC7D,aAAO;AAAA,QACN;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AAnDS;AAqDT,IAAI;AACJ,IAAI,OAAO,wCAAU,UAAU;AAC9B,kBAAgB,oBAAoB,mCAAK;AAC1C,WAAW,OAAO,wCAAU,YAAY;AACvC,kBAAgB,qBAAqB,mCAAK;AAC3C;AACA,IAAO,kCAAQ;",
  "names": ["now"]
}
